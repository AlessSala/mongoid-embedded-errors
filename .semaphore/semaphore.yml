version: v1.0
name: mongoid-embedded-errors
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: Code Climate
    task:
      jobs:
      - name: Code Climate
        commands: 
          - checkout 
          - cache restore gems-$SEMAPHORE_GIT_BRANCH-$(checksum Gemfile.lock),gems-$SEMAPHORE_GIT_BRANCH,gems-master
          - bundle install --path vendor/bundle
          - cache store gems-$SEMAPHORE_GIT_BRANCH-$(checksum Gemfile.lock) vendor/bundle
          - docker run   --interactive --tty --rm   --env CODECLIMATE_CODE="$PWD"  --volume "$PWD":/code   --volume /tmp/cc:/tmp/cc   --volume /var/run/docker.sock:/var/run/docker.sock   codeclimate/codeclimate analyze

